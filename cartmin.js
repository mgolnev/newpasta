(function(a){function b(a,b){var c=(a&65535)+(b&65535),d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<a.length*32;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];c[(a.length>>2)-1]=undefined;for(b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<a.length*8;b+=8)c[b>>5]|=(a.charCodeAt(b/8)&255)<<b%32;return c}function l(a){return j(i(k(a),a.length*8))}function m(a,b){var c,d=k(a),e=[],f=[],g;e[15]=f[15]=undefined,d.length>16&&(d=i(d,a.length*8));for(c=0;c<16;c+=1)e[c]=d[c]^909522486,f[c]=d[c]^1549556828;return g=i(e.concat(k(b)),512+b.length*8),j(i(f.concat(g),640))}function n(a){var b="0123456789abcdef",c="",d,e;for(e=0;e<a.length;e+=1)d=a.charCodeAt(e),c+=b.charAt(d>>>4&15)+b.charAt(d&15);return c}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"use strict",typeof define=="function"&&define.amd?define(function(){return t}):a.md5=t})(this);var cart_count=0;var cart_price=0;var summa=0;var first=1;
var cart=[];
var rajons = [ 'Спартановка',
               'Тракторный',
               'Краснооктябрьский до Штеменко',
               'Центральный',
               'Дзержинский до Землячки',
               'Ворошиловский',
               'Тулака',
               'Ворошиловский за 2ой продольной',
               'Дзержинский после Землячки',
               'Краснооктябрьский после Штеменко'
              ];

var freesheep = [
                 1000,
                 900,
                 550,
                 550,
                 750,
                 750,
                 900,
                 900,
                 900,
                 600
                 ];
var sheep = [
                 140,
                 120,
                 70,
                 70,
                 110,
                 90,
                 120,
                 120,
                 120,
                 90
             ];
$(document).ready(function(){cart_init();refresh_cart()});function cart_init(){try{if($.cookie('cartcontent')!=='undefined')cart=$.parseJSON($.cookie('cartcontent'))}catch(err){}if(cart==null)cart=[];$(".plate-dishes-buy").each(function(){$(this).css('position','static');$(this).css('float','left');$(this).css('left','0px');$(this).css('margin-top','4px')});$(".plate-dishes-options-buy").each(function(){$(this).append('<a class="addtocart"></a>')});$(".flexslider").each(function(){$(this).append('<div id="cartdiv" class="cartdivstay"><div id="cartstatic"></div><div id="orderdiv" class="orderdivstay"></div></div>')});var posx=$("#cartdiv").offset().left;var posy=224;$(window).scroll(function(e){if($(window).scrollTop()<posy-4){$("#cartdiv").addClass('cartdivstay').removeClass('cartdivfly');$("#cartstatic").removeClass('cartstaticfly');$("#orderdiv").addClass('orderdivstay')}else{$("#cartdiv").addClass('cartdivfly').removeClass('cartdivstay');$("#cartstatic").addClass('cartstaticfly');$("#orderdiv").removeClass('orderdivstay')}});$("#orderdiv").hide();$(".addtocart").click(function(){var params=get_params(this);add_to_cart(params);var containerLeft=$("#cartdiv").offset().left;var containerTop=$("#cartdiv").offset().top;var image=$(this).parent().parent().parent().parent().parent().find('img');var elemTop=image.offset().top;var elemLeft=image.offset().left;var elemWidth=image.width();var elemHeight=image.height();image.clone().appendTo($('body')).css({'position':'absolute','left':elemLeft,'top':elemTop,'width':elemWidth,'height':elemHeight,'z-index':'10001','opacity':'0.5'}).animate({opacity:0,left:containerLeft,top:containerTop},1200,function(){$(this).remove()})});init_order_form()}function add_to_cart(param){i=arrfind(cart,param.id);if(i>=0){cart[i].cnt++}else{param.cnt=1;cart.push(param)}refresh_cart()}function cart_minus(sender,id){i=arrfind(cart,id);if(i>=0){if(cart[i].cnt>0)cart[i].cnt--;if(cart[i].cnt<1)$(sender).parent().parent().parent().parent().hide();$(sender).next().html(cart[i].cnt+' шт.')}refresh_cart();return false}function cart_del(sender,id){i=arrfind(cart,id);if(i>=0){if(cart[i].cnt>0)cart[i].cnt=0;$(sender).parent().parent().parent().parent().hide()}refresh_cart();return false}function cart_plus(sender,id){i=arrfind(cart,id);if(i>=0){cart[i].cnt++;$(sender).prev().html(cart[i].cnt+' шт.')}refresh_cart();return false}function refresh_cart(){$.cookie('cartcontent',array2json(cart),{expires:null,path:'/',domain:document.domain});con='';for(i=0;i<cart.length;++i){if(cart[i].cnt>0){con+='<div class="cartitem"><table><tr>';con+='<td><img src="'+cart[i].img+'" width=40 height=40 class="cartitemimg"></td>';con+='<td><div class="itemtext"><span class="itemname">'+cart[i].name+'</span>';con+='<span class="cminus" onclick="cart_minus(this,\''+cart[i].id+'\'); return false;"></span>';con+=' <span class="cartgrey">'+cart[i].cnt+' шт.</span> ';con+='<span class="cplus" onclick="cart_plus(this,\''+cart[i].id+'\'); return false;"></span>';con+=' <span class="cartgrey">x '+cart[i].price+'</span> </td>';con+='<td><span class="itemprice">'+cart[i].price+' р</span></div></td>';con+='<td><div class="itemdel" onclick="cart_del(this,\''+cart[i].id+'\'); return false;"></div></td>';con+='</tr></table></div>'}}$("#itemsdiv").html(con);$("#itemsdiv2").mCustomScrollbar("update");refresh_sum()}function calc_sums(items,self,rship,rfreeship){drinks=0;other=0;for(i=0;i<cart.length;++i){if(items[i].cat==2)drinks+=items[i].price*items[i].cnt;else other+=items[i].price*items[i].cnt}if(self==2){discount=Math.floor(other*0.1);ship=0}else{discount=0;if(other<rfreeship)ship=rship;else ship=0}regular=drinks+other;if(regular==0)ship=0;discounted=regular-discount;total=discounted+ship;return{"other":other,"drinks":drinks,"rship":rship,"rfreeship":rfreeship,"ship":ship,"discount":discount,"regular":regular,"discounted":discounted,"total":total}}function refresh_sum(){rajid=$("#rajsel").val();cnt=0;self=(!$("#ship1").prop("checked")?1:2);for(i=0;i<cart.length;++i){cnt+=cart[i].cnt}sum=calc_sums(cart,self,sheep[rajid],freesheep[rajid]);dopespl=sum.rfreeship-sum.other;out='';if(self==1){out+='<span class="sumgray">Итого:</span> ';out+='<span class="sumorange">'+sum.total+' р</span>';summa=sum.total;if(dopespl>0){out+='<br><span class="sumgray">Доставка:</span> ';out+='<span class="sumorange">'+sum.ship+' р</span>';out+='<br><span class="sumgray">До бесплатной доставки:</span> ';out+='<span class="sumorange">'+dopespl+' р</span>'}else{out+='<br><span class="sumgray">Доставка бесплатная</span> '}}else{if(sum.discount>0){out+='<span class="sumgray">Итого:</span> ';out+='<span class="sumorange"><s>'+sum.regular+' р</s></span>';out+='<br><span class="sumgray">Сумма со скидкой:</span> ';out+='<span class="sumorange">'+sum.total+' р</span>';summa=sum.total}else{out+='<span class="sumgray">Итого:</span> ';out+='<span class="sumorange">'+sum.total+' р</span>';summa=sum.total}}$("#cartstatic").html('<img src="index_files/cartico.png"><span>'+cnt+' '+l_items(cnt)+'<br> '+summa+' '+l_rur(summa)+'</span>');$("#sumdiv").html(out)}function show_order_form(){$("#orderdiv").toggle();$("#itemsdiv2").mCustomScrollbar("update")}function init_order_form(){con='';con+='<div id="itemsdiv2"><div id="itemsdiv"></div></div>';con+='<div id="sumdiv"></div>';con+='<form method="POST">';con+='<table>';con+='<tr><td><span class="cartaddress">Район:</span></td><td><div id="cartseldiv">'+rajons[0]+'</div><select class="cartselect" id="rajsel" name=raj>';for(g=0;g<rajons.length;++g){con+='<option value="'+g+'"'+(g==0?'selected':'')+'>'+rajons[g]+'</option>'}con+='</select></td></tr>';con+='<tr><td><span class="cartaddress">Адрес:</span></td><td><input type=text class="cartinput" name="adr" id="inpadr"></td></tr>';con+='<tr><td><span class="cartaddress">Телефон:</span></td><td><input type=text class="cartinput" name="tel" id="inptel"></td></tr>';con+='</table>';con+='<div id="commadd">Добавить комментарий</div><div id="commdiv"><textarea name="comment" id="inpcom"></textarea></div>';con+='<div class="ordercntl"><span id="orderconf">Заказать</span>';con+='<input type=checkbox name=ship id="ship1" hidden><label for="ship1">самовывоз</label></div>';con+='</form>';$("#orderdiv").html(con);$("#itemsdiv2").mCustomScrollbar({scrollInertia:0,theme:"dark"});refresh_sum();$("#ship1").change(function(){refresh_sum()});$("#ship2").change(function(){refresh_sum()});$("#orderback").click(function(){$("#orderdiv").hide()});$("#commadd").click(function(){$("#commdiv").toggle()});$("#orderconf").click(function(){var datas={'cartcontent':cart,'raj':$('#cartseldiv').html(),'adr':$('#inpadr').val(),'tel':$('#inptel').val(),'comm':$('#inpcom').val(),'sum':summa,'self':($("#ship1").prop("checked")?2:1)};$.ajax({type:"POST",url:'checkout.php',dataType:'json',data:datas,success:function(result){if(result.status=='error'){alert(result.message)}else if(result.status=='succes'){clear_cart();$("#orderdiv").html('<center>Спасибо за Ваш заказ! Ожидайте звонка оператора в течении 10 минут!</center><div class="ordercntl"><span id="orderback">OK</span></div>');$("#orderback").click(function(){init_order_form();show_order_form();$("#cartstatic").click(function(){show_order_form()})})}}})});$("#rajsel").change(function(){$('#cartseldiv').html(rajons[$("#rajsel").val()]);refresh_sum()});$("#cartstatic").click(function(){show_order_form()})}function clear_cart(){cart=[];refresh_cart()}function get_params(adv){var name=$(adv).parent().parent().parent().parent().parent().find('dt.plate-dishes-specs-title').html();var price=parseInt($(adv).parent().find('div.plate-dishes-buy').html().match(/(\d+)/)[1]);var img=$(adv).parent().parent().parent().parent().parent().find('img').attr('src');var cattext=$(adv).parent().parent().parent().parent().parent().parent().parent().prev().prev().html();var cattext2=$(adv).parent().parent().parent().parent().parent().parent().parent().prev().html();if(cattext.match(/Напитки/)||cattext2.match(/Напитки/))cat=2;else cat=1;var id=md5(name+price);return{'id':id,'name':name,'price':price,'img':img,'cat':cat}}function arrfind(arr,hash){for(var i=0;i<arr.length;i++){if(arr[i].id==hash)return i}return-1}function l_items(min){min=min%100;min=(min>20)?min%10:min%20;if(min==1)return'позиция';if(min>1&&min<5)return'позиции';return'позиций'}function l_rur(min){min=min%100;min=(min>20)?min%10:min%20;if(min==1)return'рубль';if(min>1&&min<5)return'рубля';return'рублей'}function array2json(arr){var parts=[];var is_list=(Object.prototype.toString.apply(arr)==='[object Array]');for(var key in arr){var value=arr[key];if(typeof value=="object"){if(is_list)parts.push(array2json(value));else parts[key]=array2json(value)}else{var str="";if(!is_list)str='"'+key+'":';if(typeof value=="number")str+=value;else if(value===false)str+='false';else if(value===true)str+='true';else str+='"'+value.replace(/\\/g,'\\\\').replace(/"/g,'\\"')+'"';parts.push(str)}}var json=parts.join(",");if(is_list)return'['+json+']';return'{'+json+'}'}
